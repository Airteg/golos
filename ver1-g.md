### Лекція: "Три кімнати, які не чують одна одну"

Система Chrome://extensions/golos зараз складається з трьох окремих частин. Головна проблема (і складність) Chrome-розширень у тому, що ці частини живуть у **різних світах** і не можуть просто так "гукнути" одна одну. Їм потрібен телефонний зв'язок.

Ось ці три персонажі:

#### 1. Агент під прикриттям (`content-script.js`)

- **Де живе:** Прямо на веб-сторінці (на сайті Google, Facebook, чи твоєму `index.html`).
- **Що бачить:** Він бачить кнопки, поля вводу, текст статті. Він може фізично "доторкнутися" до сайту.
- **Чого не може:** Він не має права ходити в інтернет на чужі сервери (з міркувань безпеки браузера) і не вміє слухати глобальні гарячі клавіші браузера.
- **Роль:** Це твої **"Руки" та "Очі"**.

#### 2. Диспетчер (`background.js`)

- **Де живе:** У невидимій службовій кімнаті браузера Chrome. Він працює завжди, поки відкрито браузер, навіть якщо ти закрив вкладку сайту.
- **Що бачить:** Він **НЕ бачить** сторінку. Він не знає, що намальовано на екрані. Для нього вкладки — це просто номери (ID).
- **Що вміє:** Він чує твої команди (Alt+Shift+G). Він має "дозвіл на виїзд" (може робити запити в інтернет на твій сервер).
- **Роль:** Це твій **"Мозок-координатор"**.

#### 3. Зовнішній Експерт (`golos-api / index.js`)

- **Де живе:** Взагалі окремо. Це окрема програма (Node.js), яка зараз запущена у тебе в терміналі. В майбутньому це буде сервер десь у хмарі.
- **Що бачить:** Тільки той текст, який йому прислали.
- **Роль:** Це **"Цех обробки"**. Саме тут живе логіка (зараз — перетворення в CAPS LOCK, потім — штучний інтелект).

---

### Як відбувається магія (Покроковий сценарій)

Уяви, що ти хочеш перекласти речення в книзі, але сам ти (Користувач) не можеш писати в книзі.

1.  **Ти (Користувач)** натискаєш кнопку на пульті (Alt+Shift+G).
2.  Сигнал ловить **Диспетчер** (`background.js`), бо тільки у нього є пульт.
    - _Диспетчер думає:_ "О, натиснули кнопку! Але я не бачу, де курсор і який там текст. Треба дзвонити Агенту".
3.  **Диспетчер** дзвонить **Агенту** (`content-script.js`) по внутрішньому телефону (`sendMessage`):
    - _"Ало, Агенте! Терміново дай мені текст, який зараз виділений або де стоїть курсор!"_
4.  **Агент** (який сидить на сторінці) дивиться на поле вводу:
    - _"Так, бачу поле. Там написано 'привіт'. Копіюю. Відправляю Диспетчеру"._
5.  **Диспетчер** отримує текст "привіт".
    - _Диспетчер думає:_ "Ок, текст є. Тепер треба його обробити. Я сам не вмію, дзвоню Експерту".
6.  **Диспетчер** відправляє лист **Експерту** (`api`):
    - _"Шановний сервере, ось текст 'привіт', зробіть з ним магію"._
7.  **Експерт** (`index.js`) отримує лист, робить `UPPERCASE` і шле відповідь:
    - _"Ваш оброблений текст: 'ПРИВІТ'"._
8.  **Диспетчер** отримує відповідь.
    - _Диспетчер думає:_ "Чудово. Тепер треба вставити це назад. Агенте, приймай посилку!"\*
9.  **Агент** отримує новий текст і фізично замінює старий текст у полі на сторінці.

---

### Візуалізація процесу

Ось схема, яка показує ці "стіни" між компонентами. Стрілочки — це єдині способи зв'язку.

### Чому тобі здалося, що це складно?

Тому що в звичайних програмах (наприклад, коли ти пишеш просто сайт на HTML+JS), твій скрипт робить все одразу: і кнопку слухає, і текст міняє, і на сервер ходить.

А в розширенні Chrome (Manifest V3) **безпека понад усе**.

- Chrome каже: _"Я не дозволю скрипту, який читає текст (Агент), ходити в інтернет, щоб він не вкрав паролі"._
- Тому ти змушений використовувати посередника (Диспетчера).

### Що у тебе є зараз (підсумок)

Зараз ми створили **ідеальну транспортну систему**.

- Є рейки від браузера до сервера і назад.
- Вагончик їздить справно.
- Те, що вагончик зараз везе "просте вугілля" (перетворення в великі літери) замість "золота" (розпізнавання голосу) — це дрібниця. Вантаж змінити легко, головне, що залізниця працює.

### Наступний крок

Тепер, коли є розуміння, хто за що відповідає, стане легше. Треба буде лише замінити логіку в **Експерта** (backend), щоб він не просто піднімав регістр букв, а робив щось корисне.
