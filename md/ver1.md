–†–æ–∑–∫–ª–∞–¥–µ–º–æ —Å–∏—Å—Ç–µ–º–Ω–æ **–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É —Ç–æ–≥–æ, —â–æ –≤–∂–µ —î**.

---

## 0. –í–µ–ª–∏–∫–∞ –∫–∞—Ä—Ç–∏–Ω–∞

–Ñ —Ç—Ä–∏ ‚Äú—Å–≤—ñ—Ç–∏‚Äù:

1. **–°—Ç–æ—Ä—ñ–Ω–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ**
   (`http://127.0.0.1:5500/index.html`, –ø–æ—Ç—ñ–º —Ü–µ –±—É–¥–µ ChatGPT, Gmail, WhatsApp Web —ñ —Ç.–¥.)

2. **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è Chrome**

   - `manifest.json`
   - `background.js`
   - `content-script.js`

3. **Backend `golos-api`** (Node + Express)

   - `index.js`
   - endpoint `POST /process`

–ü–æ–≤–Ω–∏–π –ª–∞–Ω—Ü—é–∂–æ–∫ —Ç–∞–∫–∏–π:

> –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Üí —Å—Ç–æ—Ä—ñ–Ω–∫–∞ ‚Üí content-script ‚Üí background ‚Üí backend (GPT) ‚Üí background ‚Üí content-script ‚Üí —Å—Ç–æ—Ä—ñ–Ω–∫–∞

---

## 1. –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è Chrome

### 1.1. `manifest.json` ‚Äî ‚Äú–ø–∞—Å–ø–æ—Ä—Ç‚Äù —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è

–í—ñ–Ω –≤–∏–∑–Ω–∞—á–∞—î:

- **—Ç–∏–ø —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è** (MV3):

  ```json
  "manifest_version": 3
  ```

- **–Ω–∞–∑–≤—É, –≤–µ—Ä—Å—ñ—é, –æ–ø–∏—Å** ‚Äî —Ç–µ, —â–æ –±–∞—á–∏—Ç—å Chrome —É —Å–ø–∏—Å–∫—É —Ä–æ–∑—à–∏—Ä–µ–Ω—å:

  ```json
  "name": "Golos ‚Äì debug",
  "version": "0.1.0",
  "description": "Alt+Shift+G: –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ç–µ–∫—Å—Ç –∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—è —ñ –∑–∞–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ"
  ```

- **–ø—Ä–∞–≤–∞ (permissions)**:

  ```json
  "permissions": ["activeTab"],
  "host_permissions": ["<all_urls>"]
  ```

  - `activeTab` ‚Äî –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø–æ—Ç–æ—á–Ω–æ—é –∞–∫—Ç–∏–≤–Ω–æ—é –≤–∫–ª–∞–¥–∫–æ—é (—á–∏—Ç–∞—Ç–∏/–≤–ø–∏—Å—É–≤–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∏/–Ω–∞–¥—Å–∏–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è).
  - `host_permissions: ["<all_urls>"]` ‚Äî –¥–∞—î –ø—Ä–∞–≤–æ –ø—ñ–¥‚Äô—î–¥–Ω—É–≤–∞—Ç–∏ content-script –¥–æ –±—É–¥—å-—è–∫–æ–≥–æ —Å–∞–π—Ç—É.

- **—Ñ–æ–Ω–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç**:

  ```json
  "background": {
    "service_worker": "background.js"
  }
  ```

  –¶–µ –Ω–∞—à ‚Äú–º–æ–∑–æ–∫‚Äù, —è–∫–∏–π –∂–∏–≤–µ –æ–∫—Ä–µ–º–æ –≤—ñ–¥ —Å—Ç–æ—Ä—ñ–Ω–æ–∫.

- **–≥–∞—Ä—è—á–∞ –∫–ª–∞–≤—ñ—à–∞ (commands)**:

  ```json
  "commands": {
    "golos-process-selection": {
      "suggested_key": {
        "default": "Alt+Shift+G"
      },
      "description": "–û–±—Ä–æ–±–∏—Ç–∏ —Ç–µ–∫—Å—Ç –≤ –∞–∫—Ç–∏–≤–Ω–æ–º—É –ø–æ–ª—ñ"
    }
  }
  ```

  –¶–µ –∑–≤‚Äô—è–∑–∫–∞ –º—ñ–∂ —à–æ—Ä—Ç–∫–∞—Ç–æ–º —ñ –ø–æ–¥—ñ—î—é `chrome.commands.onCommand`.

- **content-script**:

  ```json
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["content-script.js"],
      "run_at": "document_idle"
    }
  ]
  ```

  –¶–µ –æ–∑–Ω–∞—á–∞—î:
  ‚Äú–ù–∞ –≤—Å—ñ—Ö URL —ñ–Ω–∂–µ–∫—Ç—É–π `content-script.js`, –∫–æ–ª–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∞—Å—å (document_idle).‚Äù

---

### 1.2. `background.js` ‚Äî –º–æ–∑–æ–∫ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è

–ô–æ–≥–æ —Ä–æ–ª—å:

- –Ω–µ –±–∞—á–∏—Ç—å DOM –≤–∑–∞–≥–∞–ª—ñ;
- —Å–ª—É—Ö–∞—î **–≥–∞—Ä—è—á—É –∫–ª–∞–≤—ñ—à—É**;
- —Å–ø—ñ–ª–∫—É—î—Ç—å—Å—è –∑ content-script —á–µ—Ä–µ–∑ `chrome.tabs.sendMessage`;
- —Ö–æ–¥–∏—Ç—å –Ω–∞ backend —á–µ—Ä–µ–∑ `fetch`;
- –≤–∏—Ä—ñ—à—É—î, —è–∫–∏–π —Ç–µ–∫—Å—Ç –≤—Å—Ç–∞–≤–∏—Ç–∏ –Ω–∞–∑–∞–¥.

–ì–æ–ª–æ–≤–Ω—ñ –±–ª–æ–∫–∏:

1. **–°—Ç–∞—Ä—Ç–æ–≤–∏–π –ª–æ–≥** (—Ç—ñ–ª—å–∫–∏ —â–æ–± –±–∞—á–∏—Ç–∏, —â–æ service worker –ø—ñ–¥–Ω—è–≤—Å—è):

   ```js
   console.log("[Golos] background loaded");
   ```

2. **–°–ª—É—Ö–∞—á –≥–∞—Ä—è—á–∏—Ö –∫–ª–∞–≤—ñ—à**:

   ```js
   chrome.commands.onCommand.addListener(async (command) => {
     console.log("[Golos] onCommand fired:", command);

     if (command !== "golos-process-selection") return;

     const [tab] = await chrome.tabs.query({
       active: true,
       currentWindow: true,
     });

     if (!tab || !tab.id) {
       console.warn("[Golos] –ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏");
       return;
     }

     // –î–∞–ª—ñ ‚Äì —Ä–æ–±–æ—Ç–∞ –∑ –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç–æ–º + –±–µ–∫–µ–Ω–¥–æ–º
   });
   ```

   –¢—É—Ç:

   - `onCommand` —Å–ø—Ä–∞—Ü—å–æ–≤—É—î, –∫–æ–ª–∏ —Ç–∏ –Ω–∞—Ç–∏—Å–∫–∞—î—à —à–æ—Ä—Ç–∫–∞—Ç;
   - `chrome.tabs.query` –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –ø–æ—Ç–æ—á–Ω—É –∞–∫—Ç–∏–≤–Ω—É –≤–∫–ª–∞–¥–∫—É.

3. **–ó–∞–ø–∏—Ç —Ç–µ–∫—Å—Ç—É —É content-script**:

   ```js
   chrome.tabs.sendMessage(
     tab.id,
     { type: "GOLOS_GET_TEXT" },
     async (response) => {
       if (chrome.runtime.lastError) {
         console.warn(
           "[Golos] –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –≤ content-script:",
           chrome.runtime.lastError.message
         );
         return;
       }

       if (!response || typeof response.text !== "string") {
         console.warn(
           "[Golos] –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ content-script:",
           response
         );
         return;
       }

       console.log("[Golos] captured from content-script:", response.text);

       // —Ç—É—Ç –º–∏ –≤–∂–µ –º–∞—î–º–æ —Å–∏—Ä–∏–π —Ç–µ–∫—Å—Ç
       // –¥–∞–ª—ñ ‚Äì –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –π–æ–≥–æ –Ω–∞ backend
     }
   );
   ```

4. **–í–∏–∫–ª–∏–∫ backend‚Äô–∞ (`golos-api`)**:

   ```js
   let processedText = response.text;

   try {
     const res = await fetch("http://127.0.0.1:3000/process", {
       method: "POST",
       headers: { "Content-Type": "application/json" },
       body: JSON.stringify({
         mode: "uk-clean",
         text: response.text,
       }),
     });

     if (!res.ok) {
       console.warn("[Golos] backend returned non-OK:", res.status);
     } else {
       const data = await res.json();
       if (data && typeof data.text === "string") {
         processedText = data.text;
       } else {
         console.warn(
           "[Golos] backend JSON without .text, fallback to original"
         );
       }
     }
   } catch (e) {
     console.warn("[Golos] backend fetch error, fallback to original:", e);
   }
   ```

   –¢—É—Ç –≤–∞–∂–ª–∏–≤–µ:

   - background –ø—Ä–∞—Ü—é—î —è–∫ **–∫–ª—ñ—î–Ω—Ç backend‚Äô–∞**;
   - backend –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞—î –ø—Ä–æ DOM, —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è, —Å—Ç–æ—Ä—ñ–Ω–∫–∏.

5. **–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è ‚Äú–≥–æ—Ç–æ–≤–æ–≥–æ‚Äù —Ç–µ–∫—Å—Ç—É –Ω–∞–∑–∞–¥ —É —Å—Ç–æ—Ä—ñ–Ω–∫—É (—á–µ—Ä–µ–∑ content-script)**:

   ```js
   chrome.tabs.sendMessage(tab.id, {
     type: "GOLOS_SET_TEXT",
     text: processedText,
   });
   ```

---

### 1.3. `content-script.js` ‚Äî —Ä—É–∫–∏, —â–æ —Ç–æ—Ä–∫–∞—é—Ç—å—Å—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏

–¶–µ–π —Ñ–∞–π–ª —Ä–µ–∞–ª—å–Ω–æ –∂–∏–≤–µ _–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏_:

- –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ `document`, `window`, `document.activeElement`;
- –ù–Ü–ß–û–ì–û –Ω–µ –∑–Ω–∞—î –ø—Ä–æ backend/GPT;
- —Ä–æ–±–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –¥–≤—ñ —Ä–µ—á—ñ:

  - —á–∏—Ç–∞—î —Ç–µ–∫—Å—Ç —ñ–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞;
  - –∑–∞–ø–∏—Å—É—î —Ç–µ–∫—Å—Ç –≤ –∞–∫—Ç–∏–≤–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:

1. **–õ–æ–≥ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ (–¥–ª—è –¥–µ–±–∞–≥—É)**:

   ```js
   console.log("[Golos] content-script loaded on", window.location.href);
   ```

2. **–°–ª—É—Ö–∞—á –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ background**:

   ```js
   chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
     if (message.type === "GOLOS_GET_TEXT") {
       // –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ç–µ–∫—Å—Ç —ñ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞–∑–∞–¥
     }

     if (message.type === "GOLOS_SET_TEXT") {
       // –≤—Å—Ç–∞–≤–∏—Ç–∏ —Ç–µ–∫—Å—Ç —É –ø–æ–ª–µ
     }
   });
   ```

3. **–û–±—Ä–æ–±–∫–∞ `GOLOS_GET_TEXT`**:

   ```js
   if (message.type === "GOLOS_GET_TEXT") {
     const el = document.activeElement;
     let text = "";

     if (!el) {
       text = "[–Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞]";
     } else if (
       el instanceof HTMLInputElement ||
       el instanceof HTMLTextAreaElement
     ) {
       text = el.value;
     } else if (el && el.isContentEditable) {
       text = el.textContent || "";
     } else {
       text = "[–∞–∫—Ç–∏–≤–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –Ω–µ —î input/textarea/contenteditable]";
     }

     console.log("[Golos] GET_TEXT ‚Üí", text);
     sendResponse({ text });
     return;
   }
   ```

   –¶–µ ‚Äî **—á–∏—Ç–∞–Ω–Ω—è**.

4. **–û–±—Ä–æ–±–∫–∞ `GOLOS_SET_TEXT`**:

   ```js
   if (message.type === "GOLOS_SET_TEXT") {
     const { text } = message;
     const el = document.activeElement;

     if (!el) {
       console.warn("[Golos] SET_TEXT: –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞");
       return;
     }

     if (el instanceof HTMLInputElement || el instanceof HTMLTextAreaElement) {
       el.value = text;
       el.dispatchEvent(new Event("input", { bubbles: true }));
     } else if (el && el.isContentEditable) {
       el.textContent = text;
     } else {
       console.warn("[Golos] SET_TEXT: –∞–∫—Ç–∏–≤–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è");
     }

     console.log("[Golos] SET_TEXT ‚Üí", text);
   }
   ```

   –¶–µ ‚Äî **–∑–∞–ø–∏—Å**.

   –¢—É—Ç –∂–µ –º–∏ –π –±–∞—á–∏–º–æ —Ç–≤—ñ–π –ª–æ–≥ –ø—Ä–æ ‚Äú–∞–∫—Ç–∏–≤–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è‚Äù, –∫–æ–ª–∏ —Ñ–æ–∫—É—Å –Ω–∞ `<label>`.

---

## 2. Backend `golos-api` (Node + Express)

–¶–µ –æ–∫—Ä–µ–º–∏–π –ø—Ä–æ—Ü–µ—Å, —è–∫–∏–π –∫—Ä—É—Ç–∏—Ç—å—Å—è –≤ Node.

### 2.1. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è

–¢–∏ –∑—Ä–æ–±–∏–≤:

```bash
pnpm init
pnpm add express cors
```

–û—Ç—Ä–∏–º–∞–≤:

- `package.json` ‚Äî –æ–ø–∏—Å –ø–∞–∫–µ—Ç–∞;
- `node_modules` –∑ Express/CORS.

### 2.2. `index.js`

–ö–æ–¥:

```js
const express = require("express");
const cors = require("cors");

const app = express();
const PORT = 3000;

app.use(cors());
app.use(express.json());
```

- `cors()` ‚Äî –¥–æ–∑–≤–æ–ª—è—î –∑–∞–ø–∏—Ç–∏ –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è (—ñ –≤–∑–∞–≥–∞–ª—ñ –∑ —ñ–Ω—à–∏—Ö origin‚Äô—ñ–≤).
- `express.json()` ‚Äî —â–æ–± `req.body` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–∞—Ä—Å–∏–≤—Å—è —è–∫ JSON.

### 2.3. Endpoint `/process`

```js
app.post("/process", (req, res) => {
  const { mode, text } = req.body || {};

  if (typeof text !== "string") {
    return res.status(400).json({ error: "field 'text' is required" });
  }

  // –¢–∏–º—á–∞—Å–æ–≤–∞ "–æ–±—Ä–æ–±–∫–∞" —Ç–µ–∫—Å—Ç—É (–∑–∞–º—ñ—Å—Ç—å GPT)
  const processedText = `[[${mode || "default"}]] ${text.toUpperCase()}`;

  return res.json({ text: processedText });
});
```

- –û—Ç—Ä–∏–º—É—î –≤—ñ–¥ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è `{ mode, text }`.
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ `text` ‚Äî —Ä—è–¥–æ–∫.
- –ó–∞—Ä–∞–∑ —Ä–æ–±–∏—Ç—å –ø—Ä–æ—Å—Ç—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—é (`[[mode]] + CAPS`).
- –ü–æ–≤–µ—Ä—Ç–∞—î `{ text: processedText }`.

–ö–æ–ª–∏—Å—å —Ç—É—Ç –±—É–¥–µ:

- –≤–∏–∫–ª–∏–∫ OpenAI API;
- –ª–æ–≥—ñ–∫–∞ –ø—Ä–æ–º–ø—Ç—ñ–≤;
- –º–æ–∂–ª–∏–≤–æ, —Ä—ñ–∑–Ω—ñ —Ä–µ–∂–∏–º–∏ (`uk-clean`, `en-clean`, `uk-en-mix`).

### 2.4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```js
app.listen(PORT, () => {
  console.log(`golos-api listening on http://127.0.0.1:${PORT}`);
});
```

---

## 3. –ü–æ—Ç—ñ–∫ –¥–∞–Ω–∏—Ö –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ —à–æ—Ä—Ç–∫–∞—Ç—É

–ö—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º:

1. –¢–∏ –¥–∏–∫—Ç—É—î—à/–ø–∏—à–µ—à —Ç–µ–∫—Å—Ç —É –ø–æ–ª—ñ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (input/textarea/div[contenteditable]).
2. –ù–∞—Ç–∏—Å–∫–∞—î—à —à–æ—Ä—Ç–∫–∞—Ç (Alt+Shift+G –∞–±–æ Ctrl+Alt+G ‚Äî —â–æ –∑–∞—Ä–∞–∑ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ).
3. **background.js** –æ—Ç—Ä–∏–º—É—î `onCommand("golos-process-selection")`.
4. `background.js` —á–µ—Ä–µ–∑ `chrome.tabs.sendMessage` —à–ª–µ –≤ content-script:

   ```js
   {
     type: "GOLOS_GET_TEXT";
   }
   ```

5. **content-script.js**:

   - –±–µ—Ä–µ `document.activeElement`;
   - –≤–∏—Ç—è–≥—É—î —Ç–µ–∫—Å—Ç;
   - –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î `{ text: "..." }`.

6. **background.js**:

   - –æ—Ç—Ä–∏–º—É—î —Ü–µ–π `text`;
   - —Ä–æ–±–∏—Ç—å `fetch("http://127.0.0.1:3000/process", ...)`.

7. **golos-api**:

   - –ø—Ä–∏–π–º–∞—î –∑–∞–ø–∏—Ç;
   - –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î —Ç–µ–∫—Å—Ç (–ø–æ–∫–∏ —â–æ —á–µ—Ä–µ–∑ `toUpperCase` + `[[mode]]`);
   - –ø–æ–≤–µ—Ä—Ç–∞—î `{ text: processedText }`.

8. **background.js**:

   - —á–∏—Ç–∞—î `data.text`;
   - —à–ª–µ –Ω–æ–≤–∏–π –º–µ—Å–µ–¥–∂ —É content-script:

     ```js
     { type: "GOLOS_SET_TEXT", text: processedText }
     ```

9. **content-script.js**:

   - –±–µ—Ä–µ `document.activeElement`;
   - —è–∫—â–æ —Ü–µ input/textarea/contenteditable ‚Äî –∑–∞–º—ñ–Ω—é—î —Ç–µ–∫—Å—Ç;
   - —Ç–∏ –±–∞—á–∏—à –∑–º—ñ–Ω—É –ø—Ä—è–º–æ —É –ø–æ–ª—ñ.

---

## 4. –ß–æ–º—É —Ç–∞–∫–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ö–æ—Ä–æ—à–∞ –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ —Ä–æ–∑–≤–∏—Ç–∫—É

- **–ß–∏—Å—Ç–∏–π –ø–æ–¥—ñ–ª –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç–µ–π**:

  - content-script –∑–Ω–∞—î —Ç—ñ–ª—å–∫–∏ DOM.
  - background –∑–Ω–∞—î —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ:

    - —à–æ—Ä—Ç–∫–∞—Ç–∏;
    - –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è;
    - –±–µ–∫–µ–Ω–¥.

  - backend –∑–Ω–∞—î —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ —Ç–µ–∫—Å—Ç + GPT, –≤–∑–∞–≥–∞–ª—ñ –Ω–µ –¥—É–º–∞—î –ø—Ä–æ –±—Ä–∞—É–∑–µ—Ä.

- **–õ–µ–≥–∫–æ –º—ñ–Ω—è—Ç–∏ –±—É–¥—å-—è–∫—É —á–∞—Å—Ç–∏–Ω—É**:

  - –ú–æ–∂–µ—à –∑–∞–º—ñ–Ω–∏—Ç–∏ backend –Ω–∞ —ñ–Ω—à–∏–π (—ñ–Ω—à–∏–π –ø–æ—Ä—Ç / —ñ–Ω—à–∏–π —Å–µ—Ä–≤–µ—Ä) ‚Äî —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è, —Ç—ñ–ª—å–∫–∏ URL.
  - –ú–æ–∂–µ—à –∑–∞–º—ñ–Ω–∏—Ç–∏ GPT ‚Üí —ñ–Ω—à—É LLM ‚Üí –≤–∑–∞–≥–∞–ª—ñ —Ä–µ–≥—É–ª—è—Ä–∫–∏/LanguageTool ‚Äî content-script –Ω–µ –º—ñ–Ω—è—î—Ç—å—Å—è.
  - –ú–æ–∂–µ—à –∑–∞–º—ñ–Ω–∏—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–Ω—É —á–∞—Å—Ç–∏–Ω—É (–ø–æ—Ç—ñ–º –∑—Ä–æ–±–∏—Ç–∏ Firefox extension) ‚Äî backend –Ω–µ —á—ñ–ø–∞—î—Ç—å—Å—è.

- **–î–∞–ª—ñ –ª–µ–≥–∫–æ –Ω–∞—Ä–æ—Å—Ç–∏—Ç–∏**:

  - –ø—Ä–æ—Ñ—ñ–ª—ñ / —Ä–µ–∂–∏–º–∏ –æ–±—Ä–æ–±–∫–∏ (—á–µ—Ä–µ–∑ `mode`);
  - UI popup‚Äô–∞ –¥–ª—è –≤–∏–±–æ—Ä—É —Ä–µ–∂–∏–º—É;
  - –ª–æ–≥—ñ–∫—É ‚Äú–Ω–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ –≤—Å—Ç–∞–≤–∫–∏‚Äù, ‚Äú–∑–±–µ—Ä—ñ–≥–∞—Ç–∏ markdown‚Äù, —ñ —Ç–∞–∫ –¥–∞–ª—ñ.

---

# üî• –ü–æ–≥–ª—è–¥ —ñ–∑ –±–æ–∫—É

---

# –õ–µ–∫—Ü—ñ—è: ¬´–¢—Ä–∏ –∫—ñ–º–Ω–∞—Ç–∏, —è–∫—ñ –Ω–µ —á—É—é—Ç—å –æ–¥–Ω–∞ –æ–¥–Ω—É¬ª

–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è Chrome ‚Äî —Ü–µ —Å–∏—Å—Ç–µ–º–∞, —â–æ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ **—Ç—Ä—å–æ—Ö –æ–∫—Ä–µ–º–∏—Ö —Å–≤—ñ—Ç—ñ–≤**, —ñ –∫–æ–∂–µ–Ω –∑ –Ω–∏—Ö –º–∞—î –∂–æ—Ä—Å—Ç–∫—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è.
–ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–µ ‚Äî –≤–æ–Ω–∏ _–Ω–µ –º–æ–∂—É—Ç—å —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –Ω–∞–ø—Ä—è–º—É_. –á–º –ø–æ—Ç—Ä—ñ–±–Ω—ñ ‚Äú—Ç–µ–ª–µ—Ñ–æ–Ω–∏‚Äù.

–û—Å—å —Ç—Ä–∏ —É—á–∞—Å–Ω–∏–∫–∏ –Ω–∞—à–æ—ó —Å–∏—Å—Ç–µ–º–∏:

---

## 1. –ê–≥–µ–Ω—Ç –ø—ñ–¥ –ø—Ä–∏–∫—Ä–∏—Ç—Ç—è–º (`content-script.js`)

**–î–µ –≤—ñ–Ω –∂–∏–≤–µ:** –ø—Ä—è–º–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫–∏.
–Ø–∫—â–æ —Ç–∏ –≤—ñ–¥–∫—Ä–∏–≤ Google, Facebook —á–∏ –≤–ª–∞—Å–Ω–∏–π `index.html`, ‚Äî –∞–≥–µ–Ω—Ç —Å–∏–¥–∏—Ç—å —É —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.

**–ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**

- –±–∞—á–∏—Ç—å DOM: —ñ–Ω–ø—É—Ç–∏, —Ç–µ–∫—Å—Ç–æ–≤—ñ –±–ª–æ–∫–∏, –∫—É—Ä—Å–æ—Ä, –∫–Ω–æ–ø–∫–∏;
- –º–æ–∂–µ —á–∏—Ç–∞—Ç–∏ –π –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.

**–û–±–º–µ–∂–µ–Ω–Ω—è:**

- –ù–ï –º–æ–∂–µ —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏ –Ω–∞ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–µ—Ä–≤–µ—Ä–∏;
- –ù–ï –º–æ–∂–µ —Å–ª—É—Ö–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—ñ –≥–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ –±—Ä–∞—É–∑–µ—Ä–∞.

**–†–æ–ª—å:** —Ü–µ **—Ä—É–∫–∏ –π –æ—á—ñ** —Å–∏—Å—Ç–µ–º–∏.

---

## 2. –î–∏—Å–ø–µ—Ç—á–µ—Ä (`background.js`)

**–î–µ –∂–∏–≤–µ:** —É —Å–ª—É–∂–±–æ–≤—ñ–π –∫—ñ–º–Ω–∞—Ç—ñ –±—Ä–∞—É–∑–µ—Ä–∞ ‚Äî –æ–∫—Ä–µ–º–æ –≤—ñ–¥ —Å—Ç–æ—Ä—ñ–Ω–æ–∫.
–°–ø—Ä–∞—Ü—å–æ–≤—É—î –∑–∞–≤–∂–¥–∏, –∫–æ–ª–∏ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π Chrome.

**–ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**

- —Å–ª—É—Ö–∞—î –≥–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ (`Alt+Shift+G`);
- –º–∞—î –ø—Ä–∞–≤–æ —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç;
- –º–æ–∂–µ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ content-script.

**–û–±–º–µ–∂–µ–Ω–Ω—è:**

- –ù–ï –±–∞—á–∏—Ç—å –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫—É;
- –ù–ï –∑–Ω–∞—î, –¥–µ –∫—É—Ä—Å–æ—Ä —ñ —â–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ.

**–†–æ–ª—å:** —Ü–µ **–º–æ–∑–æ–∫-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä**.

---

## 3. –ó–æ–≤–Ω—ñ—à–Ω—ñ–π –ï–∫—Å–ø–µ—Ä—Ç (`golos-api/index.js`)

**–î–µ –∂–∏–≤–µ:** –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –±—Ä–∞—É–∑–µ—Ä–∞.
–¶–µ —Å–µ—Ä–≤–µ—Ä –∞–±–æ –ª–æ–∫–∞–ª—å–Ω–∞ Node-–ø—Ä–æ–≥—Ä–∞–º–∞.

**–ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**

- –æ–±—Ä–æ–±–ª—è—î —Ç–µ–∫—Å—Ç;
- –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—É –ª–æ–≥—ñ–∫—É (–∑–∞—Ä–∞–∑ CAPS LOCK, –ø–æ—Ç—ñ–º ‚Äî —â–æ—Å—å —Å–∫–ª–∞–¥–Ω—ñ—à–µ).

**–û–±–º–µ–∂–µ–Ω–Ω—è:**

- –ù–ï –±–∞—á–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫;
- –ù–ï –±–∞—á–∏—Ç—å DOM —ñ –∫—É—Ä—Å–æ—Ä;
- –ø—Ä–∞—Ü—é—î –ª–∏—à–µ –∑ —Ç–∏–º —Ç–µ–∫—Å—Ç–æ–º, —è–∫–∏–π –Ω–∞–¥—ñ—Å–ª–∞–≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä.

**–†–æ–ª—å:** —Ü–µ **—Ü–µ—Ö –æ–±—Ä–æ–±–∫–∏**.

---

# –Ø–∫ –ø—Ä–∞—Ü—é—î —Å–∏—Å—Ç–µ–º–∞?

–£—è–≤–∏ —Å—Ü–µ–Ω—É:

### üé¨ –¢–∏ –Ω–∞—Ç–∏—Å–∫–∞—î—à –≥–∞—Ä—è—á—É –∫–ª–∞–≤—ñ—à—É.

1. **–î–∏—Å–ø–µ—Ç—á–µ—Ä** —á—É—î —Å–∏–≥–Ω–∞–ª:
   _‚Äú–ö–æ–º–∞–Ω–¥–∞ –≤–∏–∫–æ–Ω–∞–Ω–∞! –¢—Ä–µ–±–∞ –¥—ñ—è—Ç–∏!‚Äù_

2. –ê–ª–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä –Ω–µ –±–∞—á–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫–∏, —Ç–æ–º—É —Ç–µ–ª–µ—Ñ–æ–Ω—É—î **–ê–≥–µ–Ω—Ç—É**:
   _‚Äú–ê–≥–µ–Ω—Ç–µ, –¥–∞–π –º–µ–Ω—ñ —Ç–µ–∫—Å—Ç –ø—ñ–¥ –∫—É—Ä—Å–æ—Ä–æ–º!‚Äù_

3. **–ê–≥–µ–Ω—Ç** –¥–∏–≤–∏—Ç—å—Å—è –≤ DOM —ñ –∫–∞–∂–µ:
   _‚Äú–¢—É—Ç –Ω–∞–ø–∏—Å–∞–Ω–æ: ‚Äò–ø—Ä–∏–≤—ñ—Ç‚Äô. –í—ñ–¥–ø—Ä–∞–≤–ª—è—é!‚Äù_

4. **–î–∏—Å–ø–µ—Ç—á–µ—Ä** –±–µ—Ä–µ —Ç–µ–∫—Å—Ç —ñ –∑–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ –ï–∫—Å–ø–µ—Ä—Ç–∞:
   _‚Äú–û—Å—å —Ç–µ–∫—Å—Ç. –û–±—Ä–æ–±–∏ –π–æ–≥–æ.‚Äù_

5. **–ï–∫—Å–ø–µ—Ä—Ç** –ø–æ–≤–µ—Ä—Ç–∞—î:
   _‚Äú–ì–æ—Ç–æ–≤–æ: ‚Äò–ü–†–ò–í–Ü–¢‚Äô.‚Äù_

6. –î–∏—Å–ø–µ—Ç—á–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É—î –Ω–∞–∑–∞–¥ **–ê–≥–µ–Ω—Ç—É**:
   _‚Äú–ó–∞–ø–∏—à–∏ —Ü–µ–π –Ω–æ–≤–∏–π —Ç–µ–∫—Å—Ç —É –ø–æ–ª–µ.‚Äù_

7. **–ê–≥–µ–Ω—Ç** –∑–º—ñ–Ω—é—î —Ç–µ–∫—Å—Ç –Ω–∞ –µ–∫—Ä–∞–Ω—ñ.

---

# –î—ñ–∞–≥—Ä–∞–º–∞ –æ–±–º—ñ–Ω—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏

```
[User]
   ‚Üì (–≥–∞—Ä—è—á–∞ –∫–ª–∞–≤—ñ—à–∞)
[Background.js] ‚Äî ¬´–î–∏—Å–ø–µ—Ç—á–µ—Ä¬ª
   ‚Üì ask GET_TEXT
[Content-script] ‚Äî ¬´–ê–≥–µ–Ω—Ç¬ª
   ‚Üë send text
[Background.js]
   ‚Üì send to API
[golos-api] ‚Äî ¬´–ï–∫—Å–ø–µ—Ä—Ç¬ª
   ‚Üë processed text
[Background.js]
   ‚Üì set NEW_TEXT
[Content-script]
   ‚Üí –ó–∞–º—ñ–Ω—é—î —Ç–µ–∫—Å—Ç —É DOM
```

---

# –ß–æ–º—É Chrome-—Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –∑–¥–∞—é—Ç—å—Å—è —Å–∫–ª–∞–¥–Ω–∏–º–∏

–£ –∑–≤–∏—á–∞–π–Ω–æ–º—É JavaScript —É —Ç–µ–±–µ —î –æ–¥–∏–Ω —Ñ–∞–π–ª, —è–∫–∏–π:

- —ñ —Å–ª—É—Ö–∞—î –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É,
- —ñ –º—ñ–Ω—è—î DOM,
- —ñ —Ä–æ–±–∏—Ç—å HTTP-–∑–∞–ø–∏—Ç–∏.

–£ Chrome —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—ñ **–Ω–µ –º–æ–∂–Ω–∞ —Ç–∞–∫ —Ä–æ–±–∏—Ç–∏**, –±–æ –±—Ä–∞—É–∑–µ—Ä —Ä–æ–∑–¥—ñ–ª—è—î —á–∞—Å—Ç–∏–Ω–∏ —Å–∏—Å—Ç–µ–º–∏ –∑ –º—ñ—Ä–∫—É–≤–∞–Ω—å –±–µ–∑–ø–µ–∫–∏:

- —Ç–æ–π, —Ö—Ç–æ –±–∞—á–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É, –Ω–µ –º–∞—î –ø—Ä–∞–≤–∞ –≤–∏—Ö–æ–¥–∏—Ç–∏ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç;
- —Ç–æ–π, —Ö—Ç–æ –≤–∏—Ö–æ–¥–∏—Ç—å –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç, –Ω–µ –º–∞—î –ø—Ä–∞–≤–∞ —Ç–æ—Ä–∫–∞—Ç–∏—Å—è DOM;
- –≥–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ —á—É—î —Ç—ñ–ª—å–∫–∏ background.

–¢–æ–º—É —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–∑–±–∏—Ç–∞ –Ω–∞ —Ç—Ä–∏ –∫—ñ–º–Ω–∞—Ç–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –≥–æ–≤–æ—Ä–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

---

# –©–æ —Ç–∏ –≤–∂–µ –∑—Ä–æ–±–∏–≤

–¢–∏ –ø–æ–±—É–¥—É–≤–∞–≤ **–ø–æ–≤–Ω—ñ—Å—Ç—é —Ä–æ–±–æ—á—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—É —Å–∏—Å—Ç–µ–º—É**:

- –≥–∞—Ä—è—á–∞ –∫–ª–∞–≤—ñ—à–∞ –ª–æ–≤–∏—Ç—å—Å—è dispatcher‚Äô–æ–º;
- –∞–≥–µ–Ω—Ç —á–∏—Ç–∞—î —Ç–µ–∫—Å—Ç –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏;
- dispatcher –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î —Ç–µ–∫—Å—Ç –µ–∫—Å–ø–µ—Ä—Ç—É;
- –µ–∫—Å–ø–µ—Ä—Ç –ø–æ–≤–µ—Ä—Ç–∞—î –æ–±—Ä–æ–±–ª–µ–Ω–∏–π —Ç–µ–∫—Å—Ç;
- –∞–≥–µ–Ω—Ç –≤—Å—Ç–∞–≤–ª—è—î –π–æ–≥–æ –Ω–∞–∑–∞–¥ —É –ø–æ–ª–µ.

–¶–µ –≤—Å—è –ª–æ–≥—ñ–∫–∞ MVP.

–ü—ñ–∑–Ω—ñ—à–µ –º–∏ –ø—Ä–æ—Å—Ç–æ:

- –∑–∞–º—ñ–Ω–∏–º–æ CAPS LOCK –Ω–∞ —Ç–µ, —â–æ —Ö–æ—á–µ–º–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏;
- –¥–æ–¥–∞–º–æ —Ä–µ–∂–∏–º–∏ –æ–±—Ä–æ–±–∫–∏;
- –∑—Ä–æ–±–∏–º–æ –º–µ–Ω—é –≤ popup;
- –∑–±–µ—Ä–µ–º–æ —Ü–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω.

---
